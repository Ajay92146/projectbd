<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emergency Popup Tester</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #f5f7fa;
            padding: 20px;
            margin: 0;
        }
        .container { max-width: 800px; margin: 0 auto; }
        .header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header h1 { color: #e53e3e; margin-bottom: 10px; }
        .test-section {
            background: white;
            margin-bottom: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-header {
            background: #e53e3e;
            color: white;
            padding: 15px 20px;
            font-weight: 600;
        }
        .test-content { padding: 20px; }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        .test-button {
            background: #e53e3e;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        .test-button:hover { background: #c53030; }
        .test-button.secondary { background: #4a5568; }
        .status-card {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .test-results {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            max-height: 250px;
            overflow-y: auto;
        }
        .test-result {
            margin: 5px 0;
            padding: 8px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
        .test-result.pass { background: #d1fae5; color: #047857; }
        .test-result.fail { background: #fee2e2; color: #dc2626; }
        .test-result.info { background: #dbeafe; color: #1d4ed8; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚨 Emergency Popup Tester</h1>
            <p>Test BloodConnect Emergency Popup System</p>
        </div>

        <div class="test-section">
            <div class="test-header">System Status</div>
            <div class="test-content">
                <div class="status-card">
                    <p><strong>Status:</strong> <span id="status">Checking...</span></p>
                    <p><strong>Popup Visible:</strong> <span id="visible">Checking...</span></p>
                    <button class="test-button secondary" onclick="checkStatus()">Refresh</button>
                </div>
            </div>
        </div>

        <div class="test-section">
            <div class="test-header">Tests</div>
            <div class="test-content">
                <div class="test-grid">
                    <button class="test-button" onclick="testInit()">Test Init</button>
                    <button class="test-button" onclick="testDisplay()">Test Display</button>
                    <button class="test-button" onclick="testClose()">Test Close</button>
                    <button class="test-button" onclick="testAPI()">Test API</button>
                    <button class="test-button" onclick="showPopup()">Show Popup</button>
                    <button class="test-button" onclick="closePopup()">Close Popup</button>
                </div>
                <button class="test-button secondary" onclick="runAll()">Run All Tests</button>
            </div>
        </div>

        <div class="test-section">
            <div class="test-header">Results</div>
            <div class="test-content">
                <div id="results" class="test-results">
                    <div class="test-result info">Tester ready...</div>
                </div>
                <button class="test-button secondary" onclick="clearResults()">Clear</button>
            </div>
        </div>
    </div>

    <script src="js/emergency-popup.js"></script>
    <script>
        function log(msg, type='info') {
            const time = new Date().toLocaleTimeString();
            const icons = {pass:'✅', fail:'❌', info:'📝'};
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `[${time}] ${icons[type]} ${msg}`;
            document.getElementById('results').prepend(div);
        }

        function checkStatus() {
            if (!window.emergencyPopup) {
                document.getElementById('status').textContent = 'Not Loaded';
                document.getElementById('visible').textContent = 'N/A';
                return;
            }
            const s = window.emergencyPopup.getStatus();
            document.getElementById('status').textContent = s.isInitialized ? 'Initialized' : 'Not Init';
            document.getElementById('visible').textContent = s.isPopupVisible ? 'Yes' : 'No';
        }

        function testInit() {
            log('Testing initialization...');
            if (!window.emergencyPopup) {
                log('System not found', 'fail');
                return;
            }
            const s = window.emergencyPopup.getStatus();
            log(s.isInitialized ? 'Init: PASS' : 'Init: FAIL', s.isInitialized ? 'pass' : 'fail');
        }

        function testDisplay() {
            log('Testing display...');
            if (!window.emergencyPopup) {
                log('System not available', 'fail');
                return;
            }
            window.emergencyPopup.testPopup();
            setTimeout(() => {
                const s = window.emergencyPopup.getStatus();
                log(s.isPopupVisible ? 'Display: PASS' : 'Display: FAIL', s.isPopupVisible ? 'pass' : 'fail');
            }, 500);
        }

        function testClose() {
            log('Testing close...');
            if (!window.emergencyPopup) {
                log('System not available', 'fail');
                return;
            }
            window.emergencyPopup.testPopup();
            setTimeout(() => {
                window.emergencyPopup.closePopup();
                setTimeout(() => {
                    const s = window.emergencyPopup.getStatus();
                    log(!s.isPopupVisible ? 'Close: PASS' : 'Close: FAIL', !s.isPopupVisible ? 'pass' : 'fail');
                }, 100);
            }, 500);
        }

        function testAPI() {
            log('Testing API...');
            if (!window.emergencyPopup) {
                log('System not available', 'fail');
                return;
            }
            try {
                window.emergencyPopup.checkEmergencyRequests();
                log('API: PASS', 'pass');
            } catch (e) {
                log('API: FAIL - ' + e.message, 'fail');
            }
        }

        function showPopup() {
            if (window.emergencyPopup) {
                window.emergencyPopup.testPopup();
                log('Popup shown manually');
            }
        }

        function closePopup() {
            if (window.emergencyPopup) {
                window.emergencyPopup.closePopup();
                log('Popup closed manually');
            }
        }

        function runAll() {
            log('Running all tests...');
            testInit();
            setTimeout(() => testDisplay(), 1000);
            setTimeout(() => testClose(), 2000);
            setTimeout(() => testAPI(), 3000);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '<div class="test-result info">Results cleared</div>';
        }

        setTimeout(() => {
            checkStatus();
            log('Tester initialized');
        }, 1000);
    </script>
</body>
</html>